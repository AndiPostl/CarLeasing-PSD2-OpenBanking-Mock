{"info":{"name":"CarLeasing PSD2 ASPSP – Test Collection","description":"Flat Postman collection for CarLeasing ASPSP. Run in order 1–9. Matches scripts/run-e2e-loan-flow.sh. Variables: baseUrl, access_token, consentId, loanAccountId (3dc3d5b3-7023-4848-9853-f5400a64e81a), dateFrom (2020-01-01), dateTo (2026-12-31).","schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"},"variable":[{"key":"baseUrl","value":"http://localhost:8081"},{"key":"access_token","value":"mock-token-carleasing"},{"key":"consentId","value":""},{"key":"loanAccountId","value":"3dc3d5b3-7023-4848-9853-f5400a64e81a"},{"key":"dateFrom","value":"2020-01-01"},{"key":"dateTo","value":"2026-12-31"}],"item":[{"name":"1. Non PSD2 Get Mock Token","event":[{"listen":"test","script":{"exec":["pm.collectionVariables.set('access_token', 'mock-token-carleasing');","pm.test('Token set for mock', function () { pm.response.to.have.status(200); });"],"type":"text/javascript"}}],"request":{"method":"GET","header":[],"url":"{{baseUrl}}/mock/token","description":"Mock-only: returns 200 and placeholder token. Matches e2e script step 1."}},{"name":"2. PSD2 Consent Create consent","event":[{"listen":"prerequest","script":{"exec":["pm.request.headers.upsert({ key: 'X-Request-ID', value: pm.variables.replaceIn('{{$guid}}') });"],"type":"text/javascript"}},{"listen":"test","script":{"exec":["pm.test('Status is 201', function () { pm.response.to.have.status(201); });","const json = pm.response.json();","if (json.consentId) pm.collectionVariables.set('consentId', json.consentId);","if (json._links && json._links.scaRedirect && json._links.scaRedirect.href) {","  pm.collectionVariables.set('scaRedirectUrl', json._links.scaRedirect.href);","}"],"type":"text/javascript"}}],"request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"},{"key":"Accept","value":"application/json"},{"key":"Authorization","value":"Bearer {{access_token}}"},{"key":"X-Request-ID","value":"{{$guid}}"},{"key":"PSU-IP-Address","value":"192.168.1.1"},{"key":"TPP-Redirect-URI","value":"https://tpp.example/callback"}],"body":{"mode":"raw","raw":"{\n  \"access\": {\n    \"availableAccounts\": \"allAccounts\",\n    \"allPsd2\": \"allAccounts\"\n  },\n  \"recurringIndicator\": false,\n  \"validUntil\": \"2026-12-31\",\n  \"frequencyPerDay\": 4\n}"},"url":"{{baseUrl}}/v1/consents","description":"Creates a consent. Matches e2e script step 2: same headers and body."}},{"name":"3. Non PSD2 Simulate approval","event":[{"listen":"test","script":{"exec":["pm.test('Status is 200 or 302', function () {","  pm.expect(pm.response.code).to.be.oneOf([200, 302]);","});"],"type":"text/javascript"}}],"request":{"method":"GET","header":[],"url":"{{baseUrl}}/mock/approve?consent={{consentId}}","description":"Mock-only: marks consent as valid. Run after Create consent. Matches e2e script step 3."}},{"name":"4. PSD2 Consent Get consent","event":[{"listen":"prerequest","script":{"exec":["pm.request.headers.upsert({ key: 'X-Request-ID', value: pm.variables.replaceIn('{{$guid}}') });"],"type":"text/javascript"}},{"listen":"test","script":{"exec":["pm.test('Status is 200', function () { pm.response.to.have.status(200); });","const json = pm.response.json();","pm.test('Consent has status', function () { pm.expect(json.consentStatus).to.be.oneOf(['received','valid','rejected','expired','terminatedByPsu','terminatedByTpp']); });"],"type":"text/javascript"}}],"request":{"method":"GET","header":[{"key":"Accept","value":"application/json"},{"key":"Authorization","value":"Bearer {{access_token}}"},{"key":"X-Request-ID","value":"{{$guid}}"},{"key":"PSU-IP-Address","value":"192.168.1.1"}],"url":"{{baseUrl}}/v1/consents/{{consentId}}","description":"Retrieves consent status. Matches e2e script step 4."}},{"name":"5. PSD2 Loan Get loan list","event":[{"listen":"prerequest","script":{"exec":["pm.request.headers.upsert({ key: 'X-Request-ID', value: pm.variables.replaceIn('{{$guid}}') });"],"type":"text/javascript"}},{"listen":"test","script":{"exec":["pm.test('Status is 200', function () { pm.response.to.have.status(200); });","const json = pm.response.json();","if (json.loanAccounts && json.loanAccounts[0] && json.loanAccounts[0].resourceId) {","  pm.collectionVariables.set('loanAccountId', json.loanAccounts[0].resourceId);","}"],"type":"text/javascript"}}],"request":{"method":"GET","header":[{"key":"Accept","value":"application/json"},{"key":"Authorization","value":"Bearer {{access_token}}"},{"key":"consentId","value":"{{consentId}}"},{"key":"X-Request-ID","value":"{{$guid}}"},{"key":"PSU-IP-Address","value":"192.168.1.1"}],"url":"{{baseUrl}}/v1/loans","description":"List loan accounts. Run after consent is valid. Matches e2e script step 5."}},{"name":"6. PSD2 Loan Get loan details","event":[{"listen":"prerequest","script":{"exec":["pm.request.headers.upsert({ key: 'X-Request-ID', value: pm.variables.replaceIn('{{$guid}}') });"],"type":"text/javascript"}},{"listen":"test","script":{"exec":["pm.test('Status is 200', function () { pm.response.to.have.status(200); });","pm.test('Has loanAccount', function () {","  const json = pm.response.json();","  pm.expect(json).to.have.property('loanAccount');","});"],"type":"text/javascript"}}],"request":{"method":"GET","header":[{"key":"Accept","value":"application/json"},{"key":"Authorization","value":"Bearer {{access_token}}"},{"key":"consentId","value":"{{consentId}}"},{"key":"X-Request-ID","value":"{{$guid}}"},{"key":"PSU-IP-Address","value":"192.168.1.1"}],"url":"{{baseUrl}}/v1/loans/{{loanAccountId}}","description":"Details of one loan account. Matches e2e script step 6."}},{"name":"7. PSD2 Loan Get loan balances","event":[{"listen":"prerequest","script":{"exec":["pm.request.headers.upsert({ key: 'X-Request-ID', value: pm.variables.replaceIn('{{$guid}}') });"],"type":"text/javascript"}},{"listen":"test","script":{"exec":["pm.test('Status is 200', function () { pm.response.to.have.status(200); });","pm.test('Has balances', function () {","  const json = pm.response.json();","  pm.expect(json).to.have.property('balances');","});"],"type":"text/javascript"}}],"request":{"method":"GET","header":[{"key":"Accept","value":"application/json"},{"key":"Authorization","value":"Bearer {{access_token}}"},{"key":"consentId","value":"{{consentId}}"},{"key":"X-Request-ID","value":"{{$guid}}"},{"key":"PSU-IP-Address","value":"192.168.1.1"}],"url":"{{baseUrl}}/v1/loans/{{loanAccountId}}/balances","description":"Balances for one loan. Matches e2e script step 7."}},{"name":"8. PSD2 Loan Get loan transactions","event":[{"listen":"prerequest","script":{"exec":["pm.request.headers.upsert({ key: 'X-Request-ID', value: pm.variables.replaceIn('{{$guid}}') });"],"type":"text/javascript"}},{"listen":"test","script":{"exec":["pm.test('Status is 200', function () { pm.response.to.have.status(200); });","pm.test('Has transactions', function () {","  const json = pm.response.json();","  pm.expect(json).to.have.property('transactions');","});"],"type":"text/javascript"}}],"request":{"method":"GET","header":[{"key":"Accept","value":"application/json"},{"key":"Authorization","value":"Bearer {{access_token}}"},{"key":"consentId","value":"{{consentId}}"},{"key":"X-Request-ID","value":"{{$guid}}"},{"key":"PSU-IP-Address","value":"192.168.1.1"}],"url":"{{baseUrl}}/v1/loans/{{loanAccountId}}/transactions?dateFrom={{dateFrom}}&dateTo={{dateTo}}","description":"Transaction history for one loan. Matches e2e script step 8 (dateFrom/dateTo)."}},{"name":"9. PSD2 Consent Delete consent","event":[{"listen":"prerequest","script":{"exec":["pm.request.headers.upsert({ key: 'X-Request-ID', value: pm.variables.replaceIn('{{$guid}}') });"],"type":"text/javascript"}},{"listen":"test","script":{"exec":["pm.test('Status is 204', function () { pm.response.to.have.status(204); });"],"type":"text/javascript"}}],"request":{"method":"DELETE","header":[{"key":"Authorization","value":"Bearer {{access_token}}"},{"key":"X-Request-ID","value":"{{$guid}}"},{"key":"PSU-IP-Address","value":"192.168.1.1"}],"url":"{{baseUrl}}/v1/consents/{{consentId}}","description":"Revokes the consent. Matches e2e script step 9."}}]}
